import{o as x,n as B,a as _,g as I,w as O,b as W,c as F,s as G,t as m,d as J,u as K,r as P,e as $,f as q,h as V,i as H,j as Y,k as z}from"./index-DY8hqqhL.js";import{D as R,a as N,b as Q}from"./conf-DeAlgiNn.js";function X(){return document.getElementById(N)??void 0}function Z(){return new window.APlayer({container:X(),lrcType:R,audio:[],mutex:!0,preload:"auto",order:"list"})}function ee(e){return W()?(F(e),!0):!1}const D=typeof window<"u"&&typeof document<"u";typeof WorkerGlobalScope<"u"&&globalThis instanceof WorkerGlobalScope;const te=Object.prototype.toString,ne=e=>te.call(e)==="[object Object]",oe=()=>{};function L(e){return Array.isArray(e)?e:[e]}function M(e){return I()}function ae(e,o=!0,t){M()?x(e,t):o?e():B(e)}function re(e,o){M()&&_(e,o)}function le(e,o,t){return O(e,o,{...t,immediate:!0})}const se=D?window:void 0,ue=D?window.document:void 0;function ie(e){var o;const t=m(e);return(o=t==null?void 0:t.$el)!=null?o:t}function k(...e){const o=[],t=()=>{o.forEach(r=>r()),o.length=0},u=(r,l,s,c)=>(r.addEventListener(l,s,c),()=>r.removeEventListener(l,s,c)),i=J(()=>{const r=L(m(e[0])).filter(l=>l!=null);return r.every(l=>typeof l!="string")?r:void 0}),p=le(()=>{var r,l;return[(l=(r=i.value)==null?void 0:r.map(s=>ie(s)))!=null?l:[se].filter(s=>s!=null),L(m(i.value?e[1]:e[0])),L(K(i.value?e[2]:e[1])),m(i.value?e[3]:e[2])]},([r,l,s,c])=>{if(t(),!(r!=null&&r.length)||!(l!=null&&l.length)||!(s!=null&&s.length))return;const n=ne(c)?{...c}:c;o.push(...r.flatMap(d=>l.flatMap(v=>s.map(g=>u(d,v,g,n)))))},{flush:"post"}),f=()=>{p(),t()};return ee(t),f}function ce(e,o=oe,t={}){const{immediate:u=!0,manual:i=!1,type:p="text/javascript",async:f=!0,crossOrigin:r,referrerPolicy:l,noModule:s,defer:c,document:n=ue,attrs:d={}}=t,v=G(null);let g=null;const U=h=>new Promise((S,b)=>{const A=y=>(v.value=y,S(y),y);if(!n){S(!1);return}let T=!1,a=n.querySelector(`script[src="${m(e)}"]`);a?a.hasAttribute("data-loaded")&&A(a):(a=n.createElement("script"),a.type=p,a.async=f,a.src=m(e),c&&(a.defer=c),r&&(a.crossOrigin=r),s&&(a.noModule=s),l&&(a.referrerPolicy=l),Object.entries(d).forEach(([y,j])=>a==null?void 0:a.setAttribute(y,j)),T=!0);const w={passive:!0};k(a,"error",y=>b(y),w),k(a,"abort",y=>b(y),w),k(a,"load",()=>{a.setAttribute("data-loaded","true"),o(a),A(a)},w),T&&(a=n.head.appendChild(a)),h||A(a)}),E=(h=!0)=>(g||(g=U(h)),g),C=()=>{if(!n)return;g=null,v.value&&(v.value=null);const h=n.querySelector(`script[src="${m(e)}"]`);h&&n.head.removeChild(h)};return u&&!i&&ae(E),i||re(C),{scriptTag:v,load:E,unload:C}}function de(){const e=P(),o=async n=>{e.value.on("loadeddata",()=>{console.log("aplayerLoadeddata:",new Date().toString()),n()})},t=n=>{n()},u=()=>{e.value.toggle()},i=()=>{e.value.skipForward()},p=()=>{e.value.skipBack()},f=n=>{e.value.volume(n,!0)};return{aplayerRef:e,onAplayerLoadeddata:o,onAplayerReady:t,skipForward:i,skipBack:p,toggle:u,volume:f,changePlayList:n=>{!m(e)||!m(e).list||(e.value.list.clear(),e.value.list.add(n))},onKeydown:n=>{document.addEventListener("keydown",d=>{d.code==="Space"&&(d.preventDefault(),u()),d.keyCode===39&&(d.preventDefault(),i()),d.keyCode===37&&(d.preventDefault(),p()),d.keyCode===38&&n.volume<=1&&(n.volume+=.1,f(n.volume)),d.keyCode===40&&n.volume>=0&&(n.volume+=-.1,f(n.volume))})},pause:()=>{e.value.pause()},destroy:()=>{e.value.destroy()}}}async function fe(e,o){const t=P(),{aplayerRef:u,onKeydown:i,onAplayerLoadeddata:p,onAplayerReady:f,changePlayList:r,pause:l}=de(),s=$({volume:e.volume,lrcType:e.lrcType,songs:e.songs});return O(()=>s.songs,c=>{r(c)}),q(()=>{s.volume=e.volume,s.lrcType=e.lrcType,s.songs=e.songs}),_(()=>{l(),u.value=null}),await pe(u),i(s),f(()=>o("aplayerReady")),p(()=>o("aplayerLoadeddata")),{containerRef:t,aplayerRef:u}}async function pe(e){const o=new URL(""+new URL("../APlayer.min.js",import.meta.url).href,import.meta.url).href,{load:t,unload:u}=ce(o,()=>{e.value=Z()},{manual:!0});await t(),u()}const ye=V({name:"AplayerJs",inheritAttrs:!1,__name:"index",props:{volume:{default:Q},songs:{default:()=>[]},lrcType:{default:R}},emits:["aplayerLoadeddata","aplayerReady"],async setup(e,{emit:o}){let t,u;const i=e,p=o,{containerRef:f}=([t,u]=H(()=>fe(i,p)),t=await t,u(),t);return(r,l)=>(z(),Y("div",{ref_key:"containerRef",ref:f},null,512))}}),ge=ye;export{ge as default};
