import{r as h,o as k,C as B,h as R,d as L,j as S,q as z,D as A,x as D,k as v,_ as b,m as x,z as M,A as E,u as f,S as U,E as H,G as j,a as G}from"./index-DY8hqqhL.js";import{a as I,e as O,f as W,h as N,i as V,j as F}from"./conf-DeAlgiNn.js";import{u as T}from"./useRouter-Cx65-gF2.js";function J(){const t=h();return{musicBgRef:t,changeMusicBg:()=>{const o=document.querySelector(`#${I} .aplayer-pic`),n=new Image;n.src=O(o.style.backgroundImage),n.onload=function(){t.value.style.backgroundImage=o.style.backgroundImage}}}}function K(){k(()=>{const t=window.innerHeight*1;document.documentElement.style.setProperty("--vh",`${t}px`),window.addEventListener("resize",()=>{const s=window.innerHeight*1;document.documentElement.style.setProperty("--vh",`${s}px`)})})}async function Q(t){try{const{id:s,type:o,server:n}=t,a=`${t.host?t.host:"https://meting-api.zdog.top/meting/api"}?server=${n}&type=${o}&id=${s}&r=${Math.random()}`;return await(await fetch(a)).json()}catch(s){return console.log("获取远程服务器数据失败:",s),alert("获取网络歌单出错"),Promise.resolve([])}}function de(){const t=B();async function s(){let o=[];const n=t.query.url?decodeURIComponent(t.query.url):"";return n?o=await W(n):o=(await N()).songs,o}return{loadSongs:s}}function ue(){const t=B();return{loadSongs:async()=>{let o=t.query.id?decodeURIComponent(t.query.id):"",n=t.query.server?decodeURIComponent(t.query.server):"",c=t.query.type?decodeURIComponent(t.query.type):"",a=t.query.host?decodeURIComponent(t.query.host):"";if(!o){const r=V();o=r.id,n=r.server,c=r.type}return o&&n&&c?await Q({id:o,server:n,type:c,host:a}):[]}}}function X(){K();const t=h(),{musicBgRef:s,changeMusicBg:o}=J();return{musicBgRef:s,heoMusicPageRef:t,handlePlayerLoadedData:()=>{o()}}}const Y=R({name:"CircleBtn",inheritAttrs:!1,__name:"index",props:{text:{default:"按钮"},style:{default:void 0},hide:{type:Boolean}},emits:["click"],setup(t){const s=t,o=L(()=>({"circle-btn":!0,"circle-btn-hide":s.hide,"circle-btn-hover":s.hide}));return(n,c)=>(v(),S("div",{class:A(o.value),style:z(s.style),onClick:c[0]||(c[0]=a=>n.$emit("click"))},D(s.text),7))}}),Z=b(Y,[["__scopeId","data-v-10ae0ce9"]]),ee=Z,te={class:"player-core-wrapper"},oe=["id"],ne=["id"],se=R({name:"PlayerCore",inheritAttrs:!1,__name:"index",props:{songs:{default:()=>[]}},emits:["playerReady"],setup(t){const s=t,{musicBgRef:o,heoMusicPageRef:n,handlePlayerLoadedData:c}=X(),{goHome:a}=T();return(r,i)=>(v(),S("div",te,[x("div",{id:f(F),ref_key:"musicBgRef",ref:o},null,8,oe),M(f(ee),{text:"回到首页",hide:!0,onClick:f(a)},null,8,["onClick"]),x("div",{id:f(I),ref_key:"heoMusicPageRef",ref:n,class:"localMusic"},null,8,ne),(v(),E(U,null,{default:H(()=>[M(f(j),{songs:s.songs,onAplayerLoadeddata:f(c),onAplayerReady:i[0]||(i[0]=y=>r.$emit("playerReady"))},null,8,["songs","onAplayerLoadeddata"])]),_:1}))]))}}),ae=b(se,[["__scopeId","data-v-cfaf4859"]]),fe=ae,$="abcdefghijklmnopqrstuvwxyz",q=26,re=R({__name:"index",setup(t){let s=600,o=600,n=null,c=0;const a={},r={},i={},y={},p=h(),d=h();function P(){p.value&&d.value&&(_(),n=d.value.getContext("2d"),n.font="14px SourceHanSansCN-Regular")}function w(){if(n){n.clearRect(0,0,s,o);for(let e=0;e<s;e+=q){n.beginPath();const l=n.createLinearGradient(0,0,0,o),C=.2*Math.random(),m=.8*Math.random()+.2,g=.02*Math.random();r[e]=r[e]||-C,i[e]=i[e]||0,a[e]=a[e]||-m,l.addColorStop(0,"#000000"),l.addColorStop(a[e]<0?0:a[e],"#000000"),l.addColorStop(r[e]<0?0:r[e],"#0ee30e"),l.addColorStop(i[e],"#000000"),l.addColorStop(1,"#000000"),n.fillStyle=l;for(let u=0;u<o;u+=q)y[`${e}-${u}`]=y[`${e}-${u}`]||$[Math.floor(Math.random()*$.length)],n.fillText(y[`${e}-${u}`],e,u);r[e]+=g,i[e]+=g,a[e]+=g,a[e]>1&&(a[e]=-m),r[e]>1&&(a[e]===-m?r[e]=-C:r[e]=1),i[e]>1&&(r[e]===-C&&a[e]===-m?i[e]=g:i[e]=1)}c=window.requestAnimationFrame(w)}}function _(){if(p.value&&d.value){const{offsetWidth:e,offsetHeight:l}=p.value;s=e,o=l,d.value.width=s,d.value.height=o}}return k(()=>{P(),w(),window.addEventListener("resize",_)}),G(()=>{c&&cancelAnimationFrame(c),window.removeEventListener("resize",_)}),(e,l)=>(v(),S("div",{ref_key:"boxRef",ref:p,style:{boxSizing:"border-box",width:"100%",height:"100%",display:"flex",backgroundColor:"#000"}},[x("canvas",{ref_key:"canvasRef",ref:d},null,512)],512))}}),ye=re;export{ye as C,fe as P,ue as a,de as u};
